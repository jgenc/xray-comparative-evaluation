# Scripts

## Configuration files

Before the training and testing process, you should adapt the provided configuration files in `dino/cfg`. For example, in order to train DINO on `CLCXray` you will have to do the following changes:
1. Modify all instances of `data_root` to point to the correct CLCXray path. It is strongly recommended to use absolute paths
2. Modify all instances of `ann_file` to point to the correct COCO-style annotation file. Be aware that the `test_dataloader`, `val_dataloader` and `train_dataloader` should point to the correct annotation files. Do not replace *all* instances at once! It is strongly recommended to use absolute paths.
3. `data_prefix` is a relative path from the `data_root` to the data files (the folder with the images). Be aware that the `test_dataloader`, `val_dataloader` and `train_dataloader` should point to the correct folder, if the folder structure is different for each case. Do not replace *all* instances at once! It is strongly recommended to use absolute paths.
4. Although in this instance it's correct, the `classes` attribute should be changed *if you want to train using some other kind of dataset*!
5. If you are continuing training from a previous experiment, you should change `load_from` from `None` to a string pointing to the absolute path of the weights file you want to continue from.

## Training

**Normal**
```bash
python ./mmdetection/tools/train.py \
  /path/to/cfg \
  --work-dir /path/to/training/files/output \
  --amp
```

* The first argument is reserved for the training configuration file. You can find these in `dino/cfg`
* `--work-dir` is where the training log files, configuration copy, and weights should be saved
* `--amp` enables the [Automatic Mixed Precision](https://docs.pytorch.org/docs/stable/amp.html) package. Can improve perfromance.


**Distributed**
```bash
./mmdetection/tools/dist_train.sh \
  /path/to/cfg \
  N \
  --work-dir /path/to/training/files/output \
  --amp
```

* The first argument is reserved for the training configuration file. You can find these in `dino/cfg`
* The second argument `N` refers to number of GPUs to be used.
* `--work-dir` is where the training log files, configuration copy, and weights should be saved
* `--amp` enables the [Automatic Mixed Precision](https://docs.pytorch.org/docs/stable/amp.html) package. Can improve perfromance.

## Testing

**Normal**
```bash
python ./mmdetection/tools/test.py \
  /path/to/config
```

**Distributed**
```bash
./mmdetection/tools/dist_test.sh \
  /path/to/training/config/file \
  /path/to/weights/file \
  N \
  --out /path/to/results.pkl \
  --work-dir /path/to/test/files/output
```

* The first argument should point to the training configuration file. In this case you should use the one generated by the [training](#training) step, as it modifies some paths. If you choose to use another configuration file, make sure you modify the dataset paths accordingly.
* The second argument should point to the weights/model you want to evaluate on the test set. Usually the best weights are used.
* The third argument `N` refers to number of GPUs to be used.
* `--out` should point to your desired output path of a `.pkl` file. This file can be used for further analysis, such as graph creation (see the `tools` folder for that).
* `--work-dir` is where the testing log files are going to be saved. A good practice is to include `--out` in this folder.
